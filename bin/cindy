#!/usr/bin/env ruby

require 'cindy/all'
require 'cindy/cli'

require 'readline'
require 'shellwords'

=begin
Readline.completion_proc = proc do |s|
    #
end
=end

CINDY_EXCEPTIONS = ObjectSpace.each_object(Class).select { |v| v.ancestors.include?(Exception) && 'Cindy' == v.name.split('::').first }

cli = Cindy::CLI.new
if ARGV.any?
    cli.parse ARGV
else
    while line = Readline.readline('# ', true)
        begin
            cli.parse Shellwords.split(line)
        rescue => e
            raise unless CINDY_EXCEPTIONS.include? e.class
            puts "[ ERR ] #{e}"
        end
    end
end
cli.finalize!
